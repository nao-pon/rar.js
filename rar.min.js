!function(){"use strict";var e=function(t){this.type=t||e.OPEN_URI,this.size=null,this.file=null,this.abort=null};if(e.OPEN_FILE=1,e.OPEN_URI=2,e.OPEN_LOCAL=3,"function"==typeof require&&"undefined"!=typeof process)var t=require("fs");e.prototype.open=function(i,n){this.file=i;var r=this;switch(this.type){case e.OPEN_LOCAL:t.stat(this.file,function(e,i){if(e)return n(e);r.size=i.size,t.open(r.file,"r",function(e,t){if(e)return n(e);r.fd=t,n()})});break;case e.OPEN_FILE:this.size=this.file.size,n();break;default:this.ajax({uri:this.file,type:"HEAD"},function(e,t,i){if(e)return n(e);r.size=parseInt(i.getResponseHeader("Content-Length")),n()})}},e.prototype.close=function(){this.type===e.OPEN_LOCAL&&t.close(this.fd)},e.prototype.read=function(t,i,n){this.type===e.OPEN_LOCAL?this.readLocal(t,i,n):this.type===e.OPEN_FILE?this.readFile(t,i,n):this.readUri(t,i,n)},e.prototype.readBlob=function(e,t,i,n){"function"==typeof i&&(n=i,i="application/octet-stream"),this.read(e,t,function(e,t){e?n(e):n(null,new Blob([t],{type:i}))})},e.prototype.readLocal=function(e,i,n){var r=new Buffer(e);t.read(this.fd,r,0,e,i,function(e,t,i){if(e)return n(e);for(var r=new ArrayBuffer(i.length),s=new Uint8Array(r),o=0;o<i.length;o++)s[o]=i[o];n(null,r)})},e.prototype.ajax=function(e,t){var i,n={type:"GET",uri:null,responseType:"text"};"string"==typeof e&&(e={uri:e});for(var r in e)n[r]=e[r];var s=new XMLHttpRequest;if(s.onreadystatechange=function(){if(4===s.readyState)return 200!==s.status&&206!==s.status?t("Received non-200/206 response ("+s.status+")"):void t(null,s.response,s)},s.responseType=n.responseType,s.open(n.type,n.uri,!0),n.range&&(n.range=[].concat(n.range),2===n.range.length?s.setRequestHeader("Range","bytes="+n.range[0]+"-"+n.range[1]):s.setRequestHeader("Range","bytes="+n.range[0])),this.options.xhrHeaders)for(i in this.options.xhrHeaders)this.options.xhrHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this.options.xhrHeaders[i]);if(this.options.xhrFields)for(i in this.options.xhrFields)this.options.xhrFields.hasOwnProperty(i)&&i in s&&(s[i]=this.options.xhrFields[i]);s.send()},e.prototype.readUri=function(e,t,i){this.ajax({uri:this.file,type:"GET",responseType:"arraybuffer",range:[t,t+e-1]},function(e,t){return e?i(e):i(null,t)})},e.prototype.readFile=function(e,t,i){var n=this.file.slice(t,t+e),r=new FileReader;r.onload=function(e){i(null,e.target.result)},r.onerror=function(e){i("File read failed")},r.readAsArrayBuffer(n)},DataView.prototype.getString=function(e,t,i){t=t||0,(e=e||this.byteLength-t)<0&&(e+=this.byteLength);var n="";if("undefined"!=typeof Buffer){for(var r=[],s=t;s<t+e;s++)r.push(this.getUint8(s));return new Buffer(r).toString()}for(s=t;s<t+e;s++)n+=String.fromCharCode(this.getUint8(s));return i?n:decodeURIComponent(escape(n))},DataView.prototype.getStringUtf16=function(e,t,i){t=t||0,e=e||this.byteLength-t;var n=!1,r="",s=!1;"undefined"!=typeof Buffer&&(r=[],s=!0),e<0&&(e+=this.byteLength),i&&(65534===this.getUint16(t)&&(n=!0),t+=2,e-=2);for(var o=t;o<t+e;o+=2){var a=this.getUint16(o,n);a>=0&&a<=55295||a>=57344&&a<=65535?s?r.push(a):r+=String.fromCharCode(a):a>=65536&&a<=1114111&&(a-=65536,s?(r.push(55296+((1047552&a)>>10)),r.push(56320+(1023&a))):r+=String.fromCharCode(55296+((1047552&a)>>10))+String.fromCharCode(56320+(1023&a)))}return s?new Buffer(r).toString():decodeURIComponent(escape(r))},DataView.prototype.getSynch=function(e){for(var t=0,i=2130706432;i;)t>>=1,t|=e&i,i>>=8;return t},DataView.prototype.getUint8Synch=function(e){return this.getSynch(this.getUint8(e))},DataView.prototype.getUint32Synch=function(e){return this.getSynch(this.getUint32(e))},DataView.prototype.getUint24=function(e,t){return t?this.getUint8(e)+(this.getUint8(e+1)<<8)+(this.getUint8(e+2)<<16):this.getUint8(e+2)+(this.getUint8(e+1)<<8)+(this.getUint8(e)<<16)};var i=function(){this.name=null,this.path=null,this.size=0,this.sizePacked=0,this.crc=null,this.offset=0,this.blockSize=0,this.headerSize=0,this.encrypted=!1,this.version=null,this.time=null,this.method=null,this.os=null,this.partial=!1,this.continuesFrom=!1,this.continues=!1};i.METHOD_STORE=48,i.METHOD_FASTEST=49,i.METHOD_FAST=50,i.METHOD_NORMAL=51,i.METHOD_GOOD=52,i.METHOD_BEST=53;var n=function(){if(!(this instanceof n))return new n(arguments[0],arguments[1]);this.options={type:n.OPEN_URI};var t=arguments[0];"string"==typeof t?t={file:t,type:n.OPEN_URI}:"undefined"!=typeof window&&window.File&&t instanceof window.File&&(t={file:t,type:n.OPEN_FILE});for(var i in t)t.hasOwnProperty(i)&&(this.options[i]=t[i]);if(this.options.file){if(this.options.type===n.OPEN_FILE)"undefined"!=typeof window&&window.File&&window.FileReader&&"undefined"!=typeof ArrayBuffer||arguments[1]&&arguments[1].call(this,"Browser does not have support for the File API and/or ArrayBuffers");else if(this.options.type===n.OPEN_LOCAL&&"function"!=typeof require)return void(arguments[1]&&arguments[1].call(this,"Local paths may not be read within a browser"));this.file=this.options.file,this.rd=new e(this.options.type),this.rd.options=this.options,this.entries=[],this.valid=!1,this.validate(arguments[1])}else arguments[1]&&arguments[1].call(this,"No file was set")};n.prototype.validate=function(e){var t=this;this.rd.open(this.file,function(i){i?e&&e.call(t,i):t.rd.read(14,0,function(i,n){if(i)e&&e.call(t,i);else{var r=new DataView(n);if("Rar!\0"===r.getString(7,0,!0)){r.getUint16(7,!0);var s=r.getUint8(9),o=r.getUint16(10,!0),a=r.getUint16(12,!0);115===s?0==(128&o)?(t.valid=!0,t.readHeaders(a+7,e)):e&&e.call(t,"Encrypted RAR archives are not yet supported"):e&&e.call(t,"Invalid RAR archive")}else e&&e.call(t,"Invalid RAR archive")}})})},n.prototype.parseEntry=function(e,t){var n=this;this.rd.read(11,e,function(r,s){if(r)t&&t.call(n,r);else{var o=new DataView(s),a=o.getUint16(3,!0),l=o.getUint16(5,!0);n.rd.read(l,e,function(r,s){var o=new DataView(s),h=new i;h.partial=0!=(1&a)||0!=(2&a),h.continuesFrom=0!=(1&a),h.continues=0!=(2&a),h.offset=e,h.sizePacked=o.getUint32(7,!0),h.size=o.getUint32(11,!0),h.crc=o.getUint32(16,!0),h.time=function(){var e=o.getUint32(20,!0).toString(2);return e.length<32&&(e=new Array(32-e.length+1).join("0")+e),e=e.match(/(\d{7})(\d{4})(\d{5})(\d{5})(\d{6})(\d{5})/).slice(1).map(function(e){return parseInt(e,2)}),new Date(1980+e[0],e[1]-1,e[2],e[3],e[4],e[5])}(),h.os=function(){switch(o.getUint8(15)){case 0:return"MS-DOS";case 1:return"OS/2";case 2:return"Windows";case 3:return"Unix";case 4:return"Mac";case 5:return"BeOS"}}(),h.version=o.getUint8(24),h.method=o.getUint8(25),h.encrypted=0!=(4&a);var f=o.getUint16(26,!0);0!=(256&a)?(h.sizePacked+=4294967296*o.getUint32(32,!0),h.size+=4294967296*o.getUint32(36,!0),h.path=o.getString(f,40)):h.path=o.getString(f,32),0!=(512&a)&&-1!==h.path.indexOf("\0")&&(h.path=h.path.split("\0")[1]),h.name=h.path,-1!==h.name.indexOf("\\")?h.name=h.name.substr(h.name.lastIndexOf("\\")+1):h.name=h.name.substr(h.name.lastIndexOf("/")+1),h.headerSize=l,h.blockSize=h.headerSize+h.sizePacked,t&&t.call(n,null,h)})}})},n.prototype.readHeaders=function(e,t){var i=this,n=function(r,s){if(r)t&&t.call(i,r);else if(i.abort)t&&t.call(i,"Read headers prossesing aborted");else{var o=new DataView(s),a=(o.getUint16(0,!0),o.getUint8(2)),l=o.getUint16(3,!0),h=o.getUint16(5,!0);switch(0!=(32768&l)&&(h+=o.getUint32(7,!0)),a){case 116:i.parseEntry(e,function(r,s){r?t&&t.call(i,"Read error occurred while reading entry"):(i.entries.push(s),(e+=s.blockSize)>=i.rd.size?t&&t.call(i,null):i.rd.read(11,e,n))});break;default:if((e+=h)>=i.rd.size)return void(t&&t.call(i,null));i.rd.read(11,e,n)}}};this.rd.size<=14?t&&t.call(i,null,this.entries):this.rd.read(11,e,n)},n.prototype.get=function(e,t){this.valid?e instanceof i?e.method===i.METHOD_STORE?this.rd.readBlob(e.blockSize-1,e.offset+e.headerSize,function(e,i){e?t&&t.call(self,e):t&&t.call(self,null,i)}):t&&t.call(this,"Compression is not yet supported"):t&&t.call(this,"Invalid RAR entry, must be an instance of RarEntry"):t&&t.call(this,"Invalid RAR archive")},n.OPEN_FILE=e.OPEN_FILE,n.OPEN_URI=e.OPEN_URI,n.OPEN_LOCAL=e.OPEN_LOCAL,"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd?define("rar",[],function(){return n}):window.RarArchive=n}();